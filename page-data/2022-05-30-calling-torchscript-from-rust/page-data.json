{"componentChunkName":"component---src-templates-blog-post-js","path":"/2022-05-30-calling-torchscript-from-rust/","result":{"data":{"site":{"siteMetadata":{"title":"Higher-Order Fun"}},"markdownRemark":{"id":"1c19c24e-90c9-5856-b56c-bae63deb65c5","excerpt":"Python is the defacto standard for machine learning, however, it isn’t always the ideal platform for production workloads.\nIt can be helpful to do your model…","html":"<p>Python is the defacto standard for machine learning, however, it isn’t always the ideal platform for production workloads.\nIt can be helpful to do your model development in Python, with its rich ecosystem, and then port that model over to run inference.\nThis first post will outline converting a PyTorch model, but future posts will cover other frameworks.</p>\n<p>Moving from Python for development to a compiled language is such a common workflow that many frameworks provide bindings.\nPyTorch has <a href=\"https://pytorch.org/cppdocs/installing.html\">C++ bindings available</a>.\nThat might not sound particularly helpful for this blog post, but there is a fantastic Rust library that builds on top of those bindings called <a href=\"https://github.com/LaurentMazare/tch-rs\">tch-rs</a></p>\n<p>This first post will cover porting a PyTorch model to Rust for inference.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> torch\n<span class=\"token keyword\">from</span> torch<span class=\"token punctuation\">.</span>jit <span class=\"token keyword\">import</span> trace\n<span class=\"token keyword\">from</span> torchvision<span class=\"token punctuation\">.</span>models<span class=\"token punctuation\">.</span>efficientnet <span class=\"token keyword\">import</span> efficientnet_b0\n\nmodel <span class=\"token operator\">=</span> efficientnet_b0<span class=\"token punctuation\">(</span>pretrained<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\nmodel <span class=\"token operator\">=</span> model<span class=\"token punctuation\">.</span><span class=\"token builtin\">eval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nscripted_model <span class=\"token operator\">=</span> trace<span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">,</span> torch<span class=\"token punctuation\">.</span>rand<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">224</span><span class=\"token punctuation\">,</span> <span class=\"token number\">244</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nscripted_model<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span><span class=\"token string\">\"model.pt\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">cargo</span> new torchscripters\n     Created binary <span class=\"token punctuation\">(</span>application<span class=\"token punctuation\">)</span> <span class=\"token variable\"><span class=\"token variable\">`</span>torchscripters<span class=\"token variable\">`</span></span> package</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"toml\"><pre class=\"language-toml\"><code class=\"language-toml\"><span class=\"token punctuation\">[</span><span class=\"token table class-name\">dependencies</span><span class=\"token punctuation\">]</span>\n<span class=\"token key property\">tch</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"0.7.2\"</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"toml\"><pre class=\"language-toml\"><code class=\"language-toml\"><span class=\"token punctuation\">[</span><span class=\"token table class-name\">dependencies</span><span class=\"token punctuation\">]</span>\n<span class=\"token key property\">reqwest</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span><span class=\"token key property\">version</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"0.11.10\"</span><span class=\"token punctuation\">,</span> <span class=\"token key property\">features</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"blocking\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\n<span class=\"token key property\">tch</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"0.7.2\"</span></code></pre></div>","frontmatter":{"title":"Calling TorchScript from Rust","date":"May 30, 2022","description":null}},"previous":{"fields":{"slug":"/2022-05-01-hello-world/"},"frontmatter":{"title":"Hello World"}},"next":null},"pageContext":{"id":"1c19c24e-90c9-5856-b56c-bae63deb65c5","previousPostId":"2173754b-2a00-5855-928d-22d96b3abbdf","nextPostId":null}},"staticQueryHashes":["2841359383","3171794651","3274528899"],"slicesMap":{}}